---
title: "lab5_metagenomics"
author: "Ilay Jacques Paz"
date: "2025-10-02"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

QUESTION 1
```{r}

lapply(c("dada2","phyloseq","vegan","tidyverse",
         "Biostrings"), library, character.only = T)
# All forward and reverse fastq file names have the exact format: SAMPLENAME_R1_001.fastq and SAMPLENAME_R2_001.fastq
#Note the pattern
data_dir <-"MiSeq_SOP"
fnFs <- sort(list.files(data_dir, pattern="_R1_001.fastq", full.names = TRUE))
fnRs <- sort(list.files(data_dir, pattern="_R2_001.fastq", full.names = TRUE))
#basename removes the folder names
sample.names <- stringr::str_split_fixed(basename(fnFs),"_",2)[,1]
plotQualityProfile(fnFs[1:38])
plotQualityProfile(fnRs[1:38])
```

QUESTION 2
```{r}
filtFs <- file.path("filtered", paste0(sample.names, "_F_filt.fastq.gz"))
names(filtFs) <- sample.names
#R2
filtRs <- file.path("filtered", paste0(sample.names, "_R_filt.fastq.gz"))
names(filtRs) <- sample.names
out <- filterAndTrim(fnFs, filtFs, fnRs, filtRs, truncLen=c(240,160),
                     maxN=0, maxEE=c(2,2), truncQ = 2 ,rm.phix=TRUE,
                     compress=TRUE, multithread = TRUE)

#Some reshuffling of the data, get percent of reads left per sample as well as absolute numbers
out2 <- as.data.frame(out) %>% mutate(prop = (100*(reads.out/reads.in)))

# So far looks good
head(out2)
#Mean percent of seqs left
mean(out2$prop)
#Min percent of seqs left
min(out2$prop)
#But what's the sample with the lowest number of reads?
min(out2$reads.out)
errF <- learnErrors(filtFs, multithread=T)
errR <- learnErrors(filtRs, multithread=T)
plotErrors(errR, nominalQ=TRUE)
```
The results seen between forward and reverse reads are similar but the forward reads follow the red trendlines more closely

QUESTION 3
```{r}
readLines("Firmicutes_ASVs.fa")[1:10]
readLines("Actinobacteria_ASVs.fa")[1:10]
```
 ![BLAST nr database query for Actinobacteria part1](/Users/ipaz00/Desktop/scnsht.png) 
 ![BLAST nr database query for Actinobacteria part2 sorted by query cover](/Users/ipaz00/Desktop/drougth.png) 
 ![BLAST nr database query for Firmicutes part1](/Users/ipaz00/Desktop/g.png)
 
 
 ![BLAST nr database query for Firmicutes part2 sorted by e value](/Users/ipaz00/Desktop/gh.png)
